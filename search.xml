<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>CentOS7安装Yapi</title>
      <link href="/2019/09/11/centos7-an-zhuang-yapi/"/>
      <url>/2019/09/11/centos7-an-zhuang-yapi/</url>
      
        <content type="html"><![CDATA[<h3 id="1-安装nodejs"><a href="#1-安装nodejs" class="headerlink" title="1.安装nodejs"></a>1.安装nodejs</h3><p>1.1 安装 nvm,官网: <a href="https://github.com/nvm-sh/nvm" target="_blank" rel="noopener">https://github.com/nvm-sh/nvm</a></p><p>1.2  脚本</p><pre class=" language-shell"><code class="language-shell">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.34.0/install.sh | bash</code></pre><p>1.3 安装nodejs, 需要重新连接</p><pre class=" language-shell"><code class="language-shell">nvm insatll stable</code></pre><p>1.4 查看版本</p><pre class=" language-shell"><code class="language-shell">[root@izbp19l85l2pc4aycovp8fz ~]# node -vv12.10.0[root@izbp19l85l2pc4aycovp8fz ~]# npm -v6.10.3</code></pre><h3 id="2-安装mongoDB"><a href="#2-安装mongoDB" class="headerlink" title="2.安装mongoDB"></a>2.安装mongoDB</h3><p>2.1 官网: <a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/</a></p><p>2.2 创建repo</p><pre class=" language-shell"><code class="language-shell">vi /etc/yum.repos.d/mongodb-org-4.2.repo</code></pre><p>2.3 插入以下内容</p><pre><code>[mongodb-org-4.2]name=MongoDB Repositorybaseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/4.2/x86_64/gpgcheck=1enabled=1gpgkey=https://www.mongodb.org/static/pgp/server-4.2.asc</code></pre><p>2.4 安装:</p><pre class=" language-shell"><code class="language-shell">sudo yum install -y mongodb-org</code></pre><p>2.5 开启服务 mongod</p><pre class=" language-shell"><code class="language-shell">systemctl start mongod</code></pre><p>2.6 加入开机启动</p><pre class=" language-shell"><code class="language-shell">systemctl enable mongod</code></pre><p>2.7 查看版本</p><pre class=" language-shell"><code class="language-shell">[root@izbp19l85l2pc4aycovp8fz ~]# mongo --versionMongoDB shell version v4.2.0git version: a4b751dcf51dd249c5865812b390cfd1c0129c30OpenSSL version: OpenSSL 1.0.1e-fips 11 Feb 2013allocator: tcmallocmodules: nonebuild environment:    distmod: rhel70    distarch: x86_64    target_arch: x86_64</code></pre><h3 id="3-安装Yapi"><a href="#3-安装Yapi" class="headerlink" title="3 安装Yapi"></a>3 安装Yapi</h3><p>3.1 下载yapi安装包</p><p>GitHub网站: <a href="https://github.com/YMFE/yapi" target="_blank" rel="noopener">https://github.com/YMFE/yapi</a></p><p>下载最新安装包: <a href="https://github.com/YMFE/yapi/releases" target="_blank" rel="noopener">https://github.com/YMFE/yapi/releases</a></p><p>目前最新 v1.8.3</p><pre class=" language-shell"><code class="language-shell">mkdir /opt/yapicd /opt/yapiwget https://github.com/YMFE/yapi/archive/v1.8.3.tar.gztar -zxvf v1.8.3.tar.gz</code></pre><p>3.2</p><p>复制配置文件并修改</p><pre><code>cd /opt/yapipwdcp yapi-1.8.3/config_example.json ./config.jsonvi config.json</code></pre><p>原内容</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"port"</span><span class="token operator">:</span> <span class="token string">"3000"</span><span class="token punctuation">,</span>  <span class="token property">"adminAccount"</span><span class="token operator">:</span> <span class="token string">"admin@admin.com"</span><span class="token punctuation">,</span>  <span class="token property">"db"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"servername"</span><span class="token operator">:</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span>    <span class="token property">"DATABASE"</span><span class="token operator">:</span> <span class="token string">"yapi"</span><span class="token punctuation">,</span>    <span class="token property">"port"</span><span class="token operator">:</span> <span class="token number">27017</span><span class="token punctuation">,</span>    <span class="token property">"user"</span><span class="token operator">:</span> <span class="token string">"test1"</span><span class="token punctuation">,</span>    <span class="token property">"pass"</span><span class="token operator">:</span> <span class="token string">"test1"</span><span class="token punctuation">,</span>    <span class="token property">"authSource"</span><span class="token operator">:</span> <span class="token string">""</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"mail"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"enable"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token property">"host"</span><span class="token operator">:</span> <span class="token string">"smtp.163.com"</span><span class="token punctuation">,</span>    <span class="token property">"port"</span><span class="token operator">:</span> <span class="token number">465</span><span class="token punctuation">,</span>    <span class="token property">"from"</span><span class="token operator">:</span> <span class="token string">"***@163.com"</span><span class="token punctuation">,</span>    <span class="token property">"auth"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"user"</span><span class="token operator">:</span> <span class="token string">"***@163.com"</span><span class="token punctuation">,</span>      <span class="token property">"pass"</span><span class="token operator">:</span> <span class="token string">"*****"</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>3.3</p><p>更改说明:</p><ol><li>port : yapi 向外暴露的端口,默认3000</li><li>adminAccount: 系统管理员账号,密码默认: ymfe.org</li><li>closeRegister：禁止注册</li><li>user/pass：刚才mongodb设置的yapi的用户名和密码</li><li>mail：暂时关闭，设置为false</li></ol><p>更改后:</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"port"</span><span class="token operator">:</span> <span class="token string">"12000"</span><span class="token punctuation">,</span>  <span class="token property">"adminAccount"</span><span class="token operator">:</span> <span class="token string">"weibing@primeton.com"</span><span class="token punctuation">,</span>  <span class="token property">"db"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"servername"</span><span class="token operator">:</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span>    <span class="token property">"DATABASE"</span><span class="token operator">:</span> <span class="token string">"yapi"</span><span class="token punctuation">,</span>    <span class="token property">"port"</span><span class="token operator">:</span> <span class="token number">27017</span><span class="token punctuation">,</span>    <span class="token property">"user"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>    <span class="token property">"pass"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>    <span class="token property">"authSource"</span><span class="token operator">:</span> <span class="token string">""</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"mail"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"enable"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>    <span class="token property">"host"</span><span class="token operator">:</span> <span class="token string">"smtp.163.com"</span><span class="token punctuation">,</span>    <span class="token property">"port"</span><span class="token operator">:</span> <span class="token number">465</span><span class="token punctuation">,</span>    <span class="token property">"from"</span><span class="token operator">:</span> <span class="token string">"***@163.com"</span><span class="token punctuation">,</span>    <span class="token property">"auth"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"user"</span><span class="token operator">:</span> <span class="token string">"***@163.com"</span><span class="token punctuation">,</span>      <span class="token property">"pass"</span><span class="token operator">:</span> <span class="token string">"*****"</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>3.4 后面可以根据需求添加LADP配置</p><p>3.5 配置yapi依赖</p><pre class=" language-shell"><code class="language-shell">cd /opt/yapi/yapi-1.8.3npm install --production --registry https://registry.npm.taobao.orgnpm run install-server //安装程序会初始化数据库索引和管理员账号，管理员账号名可在 config.json 配置node server/app.js //启动服务器后，请访问 127.0.0.1:{config.json配置的端口}，初次运行会有个编译的过程，请耐心等候</code></pre><p>3.6 安装后/opt/yapi目录结构如下</p><pre><code>|-- config.json|-- init.lock|-- log`-- yapi-1.8.3    |-- CHANGELOG.md    |-- LICENSE    |-- README.md    |-- client    |-- common    |-- config_example.json    |-- doc    |-- exts    |-- nodemon.json    |-- npm-debug.log    |-- package.json    |-- plugin.json    |-- server    |-- static    |-- test    |-- webpack.alias.js    |-- yapi-base-flow.jpg    |-- ydocfile.js    `-- ykit.config.js</code></pre><h3 id="4-服务管理"><a href="#4-服务管理" class="headerlink" title="4 服务管理"></a>4 服务管理</h3><p>使用pm2管理node服务</p><p>4.1 安装pm2</p><pre class=" language-shell"><code class="language-shell">npm install -g pm2 --registry https://registry.npm.taobao.org</code></pre><p>4.2 启动服务</p><pre class=" language-shell"><code class="language-shell">cd /opt/yapi/yapi-1.8.3/serverpm2 start ./app.js</code></pre><p>4.3 重启服务</p><pre class=" language-shell"><code class="language-shell">cd /opt/yapi/yapi-1.8.3/serverpm2 restart app.js</code></pre><p>4.4 停止服务</p><pre><code>pm2 stop app</code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      
        <tags>
            
            <tag> centos,yapi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2019/09/11/hello-world/"/>
      <url>/2019/09/11/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class=" language-bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class=" language-bash"><code class="language-bash">$ hexo server</code></pre><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class=" language-bash"><code class="language-bash">$ hexo generate</code></pre><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class=" language-bash"><code class="language-bash">$ hexo deploy</code></pre><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
